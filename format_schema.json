{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Binary Format Definition",
  "type": "object",
  "required": ["fields"],
  "properties": {
    "endianness": {
      "type": "string",
      "enum": ["little", "big"],
      "default": "little",
      "description": "Byte order for multi-byte values"
    },
    "description": {
      "type": "string",
      "description": "Human-readable description of the format"
    },
    "version": {
      "type": "string",
      "description": "Version of the format specification"
    },
    "fields": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/field"
      },
      "description": "List of fields in the binary format"
    }
  },
  "definitions": {
    "field": {
      "type": "object",
      "required": ["name", "type"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the field"
        },
        "type": {
          "type": "string",
          "enum": [
            "int8", "uint8", "int16", "uint16", "int32", "uint32", "int64", "uint64",
            "float32", "float64", "char", "string", "array", "struct"
          ],
          "description": "Data type of the field"
        },
        "size": {
          "type": "integer",
          "minimum": 1,
          "description": "Size in bytes (for fixed-size strings) or element count (for fixed-size arrays)"
        },
        "encoding": {
          "type": "string",
          "default": "utf-8",
          "description": "Text encoding for string fields"
        },
        "length_field": {
          "type": "string",
          "description": "Name of field that contains the length for variable-size arrays"
        },
        "fields": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/field"
          },
          "description": "Nested fields for struct types"
        },
        "element_type": {
          "type": "string",
          "description": "Type of array elements"
        },
        "element_fields": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/field"
          },
          "description": "Field definitions for struct array elements"
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of the field"
        }
      },
      "allOf": [
        {
          "if": {
            "properties": {
              "type": {
                "const": "array"
              }
            }
          },
          "then": {
            "required": ["element_type"]
          }
        },
        {
          "if": {
            "properties": {
              "type": {
                "const": "struct"
              }
            }
          },
          "then": {
            "required": ["fields"]
          }
        }
      ]
    }
  }
}
