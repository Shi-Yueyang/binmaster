{
  "endianness": "little",
  "description": "CN map fix",
  "version": "1.0",
  "fields": [
    { "name": "file_type", "type": "uint8" },
    { "name": "structure_version", "type": "uint16" },
    { "name": "data_version", "type": "uint16" },
    { "name": "station_id", "type": "uint16" },
    {
      "name": "bos_cnt",
      "type": "uint8",
      "function": "count",
      "function_parameters": {
        "key": "boses"
      }
    },
    {
      "name": "boses",
      "type": "array",
      "length_field": "context['bos_cnt']",
      "element_type": "struct",
      "element_fields": [
        { "name": "bos_near_track_id", "type": "uint8" },
        { "name": "bos_near_addr_offset", "type": "uint16" }
      ]
    },
    {
      "name": "eos_cnt",
      "type": "uint8",
      "function": "count",
      "function_parameters": {
        "key": "eoses"
      }
    },
    {
      "name": "eoses",
      "type": "array",
      "length_field": "context['eos_cnt']",
      "element_type": "struct",
      "element_fields": [
        { "name": "eos_near_track_id", "type": "uint8" },
        { "name": "eos_near_addr_offset", "type": "uint16" }
      ]
    },
    { "name": "switch_addr_offset", "type": "uint16" },
    { "name": "balise_addr_offset", "type": "uint16" },
    { "name": "signal_addr_offset", "type": "uint16" },
    { "name": "track_addr_offset", "type": "uint16" },
    {
      "name": "fix_points",
      "type": "array",
      "size": -1,
      "element_type": "union",
      "discriminator_field": "point_type",
      "union_variants": {
        "0": [
          { "name": "point_type", "type": "uint8" },
          { "name": "neighbor_addr_offset", "type": "uint16" },
          { "name": "tsrs_id", "type": "uint32" },
          { "name": "near_station_id", "type": "uint16" },
          { "name": "near_station_boundary_type", "type": "uint8" },
          { "name": "near_station_track_id", "type": "uint8" },
          { "name": "location", "type": "int32" },
          { "name": "track_id", "type": "uint8" }
        ],
        "1": [
          { "name": "point_type", "type": "uint8" },
          { "name": "neighbor_addr_offset", "type": "uint16" },
          { "name": "tsrs_id", "type": "uint32" },
          { "name": "near_station_id", "type": "uint16" },
          { "name": "near_station_boundary_type", "type": "uint8" },
          { "name": "near_station_track_id", "type": "uint8" },
          { "name": "location", "type": "int32" },
          { "name": "track_id", "type": "uint8" }
        ],
        "254": [
          { "name": "point_type", "type": "uint8" },
          { "name": "neighbor_addr_offset", "type": "uint16" },
          { "name": "tsrs_id", "type": "uint32" },
          { "name": "near_station_id", "type": "uint16" },
          { "name": "near_station_boundary_type", "type": "uint8" },
          { "name": "near_station_track_id", "type": "uint8" },
          { "name": "location", "type": "int32" },
          { "name": "track_id", "type": "uint8" }
        ],
        "255": [
          { "name": "point_type", "type": "uint8" },
          { "name": "neighbor_addr_offset", "type": "uint16" },
          { "name": "tsrs_id", "type": "uint32" },
          { "name": "near_station_id", "type": "uint16" },
          { "name": "near_station_boundary_type", "type": "uint8" },
          { "name": "near_station_track_id", "type": "uint8" },
          { "name": "location", "type": "int32" },
          { "name": "track_id", "type": "uint8" }
        ],
        "6": [
          { "name": "point_type", "type": "uint8" },
          { "name": "track_id", "type": "uint8" },
          { "name": "direction", "type": "uint8" },
          { "name": "tip_position", "type": "int32" },
          { "name": "positioning_position", "type": "int32" },
          { "name": "reverse_position", "type": "int32" },
          { "name": "before_switch_object_data_offest", "type": "uint16" },
          { "name": "positioning_object_data_offest", "type": "uint16" },
          { "name": "reverse_object_data_offest", "type": "uint16" },
          { "name": "turnout_track", "type": "uint8" },
          { "name": "positioning_track", "type": "uint8" },
          { "name": "reverse_track", "type": "uint8" }
        ],
        "51": [
          { "name": "point_type", "type": "uint8" },
          { "name": "previous_object_offset", "type": "uint16" },
          { "name": "next_object_offset", "type": "uint16" },
          { "name": "balise_id", "type": "uint24" },
          { "name": "data_size", "type": "uint8" },
          { "name": "balise_property", "type": "uint8" },
          { "name": "balise_position", "type": "int32" },
          { "name": "balise_track", "type": "uint8" },
          { "name": "balise_cnt", "type": "uint8" },
          {
            "name": "balise_message",
            "type": "array",
            "element_type": "uint8",
            "length_field":"context['fix_points'][-1]['data_size'] - 16"
          }
        ],
        "195":[
          { "name": "point_type", "type": "uint8" },
          { "name": "previous_object_offset", "type": "uint16" },
          { "name": "next_object_offset", "type": "uint16" },
          { "name": "signal_name", "type": "string","size":8,"encoding":"ascii" },
          { "name": "signal_position", "type": "int32" },
          { "name": "signal_track", "type": "uint8" },
          { "name": "signel_type", "type": "uint8" }
        ],
        "204":[
          { "name": "point_type", "type": "uint8" },
          { "name": "track_name", "type": "string","size":8,"encoding":"ascii" },
          { "name": "track_id", "type": "uint8" },
          { "name": "lowbound_departure_balise_id", "type": "uint24" },
          { "name": "lowbound_departure_signal_name", "type": "string","size":8,"encoding":"ascii" },
          { "name": "highbound_departure_balise_id", "type": "uint24" },
          { "name": "highbound_departure_signal_name", "type": "string","size":8,"encoding":"ascii" }
        ]
      }
    }
  ]
}
